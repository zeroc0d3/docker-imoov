version: '2'

services:

### Applications Code Container #############################

  zeroc0d3_apps:
    image: tianon/true
    volumes:
      - ../:/var/www

### Workspace Utilities Container ###########################

  workspace:
    build:
      context: ./workspace
      args:
        - INSTALL_XDEBUG=false
        - INSTALL_SOAP=false
        - INSTALL_MONGO=false
        - INSTALL_NODE=false
        - INSTALL_YARN=false
        - INSTALL_DRUSH=false
        - INSTALL_AEROSPIKE_EXTENSION=false
        - INSTALL_V8JS_EXTENSION=false
        - COMPOSER_GLOBAL_INSTALL=false
        - INSTALL_WORKSPACE_SSH=false
        - INSTALL_LARAVEL_ENVOY=false
        - INSTALL_DEPLOYER=false
        - INSTALL_LINUXBREW=false
        - PUID=1000
        - PGID=1000
        - NODE_VERSION=stable
        - YARN_VERSION=latest
        - TZ=UTC
      volumes_from:
        - zeroc0d3_apps
      extra_hosts:
        # IMPORTANT: Replace with your Docker Host IP (will be appended to /etc/hosts)
        - "dockerhost:10.0.75.1"
      ports:
        - "2222:22"
      tty: true

### PHP-FPM Container #######################################

  php-fpm:
    build:
      context: ./php-fpm
      args:
        - INSTALL_XDEBUG=false
        - INSTALL_SOAP=false
        - INSTALL_MONGO=false
        - INSTALL_ZIP_ARCHIVE=false
        - INSTALL_BCMATH=false
        - INSTALL_PHPREDIS=false
        - INSTALL_MEMCACHED=false
        - INSTALL_OPCACHE=false
        - INSTALL_EXIF=false
        - INSTALL_AEROSPIKE_EXTENSION=false
        - CODEIGNITER=false
      dockerfile: Dockerfile-70
      volumes_from:
        - zeroc0d3_apps
      expose:
        - "9000"
      links:
        - workspace
      extra_hosts:
        # IMPORTANT: Replace with your Docker Host IP (will be appended to /etc/hosts)
        - "dockerhost:10.0.75.1"
      environment:
        # IMPORTANT: Set the Remote Interpreter entry matching name to `laravel`
        - PHP_IDE_CONFIG=serverName=laravel

### Nginx Server Container ##################################

  nginx:
    build:
      context: ./nginx
      args:
        - PHP_UPSTREAM=php-fpm
      volumes_from:
        - zeroc0d3_apps
      volumes:
        - ./logs/nginx/:/var/log/nginx
        - ./nginx/sites/:/etc/nginx/sites-available
      ports:
        - "80:80"
        - "443:443"
      links:
        - php-fpm

### HHVM Container ##########################################

  hhvm:
    build: 
      context: ./hhvm
      volumes_from:
        - zeroc0d3_apps
      expose:
        - "9000"
      links:
        - workspace

### MySQL Container #########################################

#  mysql:
#    build:
#      context: ./mysql
#      args:
#        - MYSQL_DATABASE=zeroc0d3_dbname
#        - MYSQL_USER=zeroc0d3_user
#        - MYSQL_PASSWORD=zeroc0d3_password
#        - MYSQL_ROOT_PASSWORD=zeroc0d3_root
#      volumes:
#        - mysql:/var/lib/mysql
#      ports:
#        - "3306:3306"

### MariaDB Container #######################################

  mariadb:
    build: ./mariadb
    volumes:
      - mariadb:/var/lib/mysql
    ports:
      - "3306:3306"
    environment:
      - MYSQL_DATABASE=zeroc0d3_dbname
      - MYSQL_USER=zeroc0d3_user
      - MYSQL_PASSWORD=zeroc0d3_password
      - MYSQL_ROOT_PASSWORD=zeroc0d3_root

### phpMyAdmin Container ####################################

  phpmyadmin:
    build: ./phpmyadmin
    environment:
      - PMA_ARBITRARY=1
      - MYSQL_USER=zeroc0d3_user
      - MYSQL_PASSWORD=zeroc0d3_password
      - MYSQL_ROOT_PASSWORD=zeroc0d3_root
    ports:
      - "8080:80"
    links:
      # for mysql container
      # - "mysql:db"
      # for mariadb container
      - "mariadb:db"


### Volumes Setup ###########################################

volumes:
  mysql:
    driver: "local"
  mariadb:
    driver: "local"
  phpmyadmin:
    driver: "local"
  sessions:    ## nothing is connected to this (- ./data/sessions:/sessions)
    driver: "local"
